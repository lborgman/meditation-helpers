<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- This page Â© Copyright 2023, Lennart Borgman -->
    <meta name="author" content="Lennart Borgman">
    <meta name="description" content="Meditation breathing timer">
    <!--
    <link rel="manifest" href="/tl/manifest-tl.json">
    <meta name="theme-color" content="#c0ca33">
    -->

    <title>About Some Meditation Tools</title>
    <link rel="icon" type="image/svg+xml" href="./img/ml.svg">

    <!-- 
    <script>
        function makeAbsLink(relLink) {
            const urlLink = new URL(relLink, location);
            const absLink = urlLink.href;
            console.log("makeAbsScriptLink:", absLink);
            return absLink;
        }

        function importModule(relSrc) {
            const absSrc = makeAbsLink(relSrc);
            return import(absSrc);
        }
        function insertHereImportmap(objRelMap) {
            const objAbsMap = {
                imports:
                    Object.fromEntries(
                        Object.entries(objRelMap).map(entry => [entry[0], makeAbsLink(entry[1])])
                    )
            }
            const jsonAbsMap = JSON.stringify(objAbsMap);
            console.log(jsonAbsMap);
            const eltMap = insertHereElement("script");
            eltMap.type = "importmap";
            eltMap.textContent = jsonAbsMap;
        }

        function insertHereElement(tagName) {
            const elt = document.createElement(tagName.toLowerCase());
            document.currentScript.insertAdjacentElement("afterend", elt);
            return elt;
        }
        function insertHereLink(relHref, rel) {
            // FIX-ME: not tested yet
            const eltLink = insertHereElement("link");
            eltLink.rel = rel;
            eltLink.href = makeAbsLink(relHref);
            return eltLink;
        }
        function insertHereScript(relSrc, eventName) {
            const eltScript = insertHereElement("script");
            let prom;
            const absSrc = makeAbsLink(relSrc);
            if (eventName) {
                prom = simpleBlockUntilEvent(window, eventName);
                eltScript.onload = () => {
                    console.log("loaded ", relSrc, eventName);
                    window.dispatchEvent(new CustomEvent(eventName))
                }
            }
            eltScript.src = absSrc;
            // FIX-ME: add timeout here:
            return prom;
        }
        function insertHereA(relLink, linkText) {
            const eltA = insertHereElement("A");
            eltA.textContent = linkText;
            eltA.href = makeAbsLink(relLink);
            return eltA;
        }
        // https://dev.to/somedood/promises-and-events-some-pitfalls-and-workarounds-elp
        function simpleBlockUntilEvent(targ, evt) {
            return new Promise(resolve => targ.addEventListener(evt, resolve, { passive: true, once: true }));
        }
    </script>
    -->
    <script src="./make-abs.js"></script>

    <script>
        insertHereImportmap({
            "util-mdc": "./src/js/mod/util-mdc.js",
            "qrjs2": "./ext/qr/qrjs2.js",
        });
    </script>


    <!-- for MWC, https://github.com/material-components/material-web -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Nunito+Sans:ital,opsz,wght@0,6..12,200..1000;1,6..12,200..1000&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
        rel="stylesheet">


    <script> insertHereScript("./src/js/error.js"); </script>



    <!-- 
    // <uniquifier>: Use a unique and descriptive class name
        // <weight>: Use a value from 200 to 1000
    -->
    <!-- 
    <style>
        .nunito-sans-<uniquifier> {
            font-family: "Nunito Sans", sans-serif;
            font-optical-sizing: auto;
            font-weight: <weight>;
            font-style: normal;
            font-variation-settings:
                "wdth" 100,
                "YTLC" 500;
        }
    </style>
    -->

    <!-- 
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    -->

    <!-- Required styles for Material Web -->
    <!-- <link rel="stylesheet" href="/ext/mdc/14.0.0/material-components-web.css"> -->
    <link rel="stylesheet" href="https://unpkg.com/material-components-web@latest/dist/material-components-web.css">

    <script>
        const mcwPromise = insertHereScript("./ext/mdc/material-components-web.js", "loaded-mcw");
    </script>

    <style>
        :root {
            --icon-button-size: 48;
            font-size: 16px;
            font-family: "Nunito Sans", sans-serif;
        }

        body {
            background-color: orange;
            background-color: #FFC107;
        }

        section {
            margin-bottom: 80px;
        }

        .logo {
            width: 50px;
            aspect-ratio: 1/1;
            outline: 1px dotted red;
            display: inline-block;
        }

        #logo-mbt {
            background-image: url(./br-timer/img/ml.svg);
            background-size: contain;
        }
    </style>

</head>

<body>

    <h1>About Some Meditation Tools</h1>

    <section>
        <p>
            This is a collection of some simple tools that might help you begin meditating.
            Currently these tools are available:
        </p>
        <ul>
            <li>
                <a href="#mmtt">
                    Mindfullness Meditation Training Timer
                </a>
            </li>
            <li>
                <a href="#mbt">
                    Meditation Breathing Timer
                </a>
            </li>
        </ul>

    </section>



    <section>

        <h2 id="mmtt">Mindfullness Meditation Training Timer</h2>
        <p>
            The Mindfullness Meditation Training Timer app
            is based on a scientific study that used a very similar app.
            You can read all about it in the app.
        </p>

        <div>
            This part is currently a separate (progressive) web app that you can
            <a href="https://medi-timer-81281.web.app/">start here</a>.
            (It can be used offline since it is a
            <a href="https://en.wikipedia.org/wiki/Progressive_web_app">PWA</a>.)
        </div>
    </section>


    <section>
        <h2 id="mbt">Meditation Breathing Timer</h2>
        <span id="logo-mbt" class="logo"></span>
        You can
        <script>
            const eltA = insertHereA("./br-timer/moving-lines.html", "start it here");
            eltA.style.fontSize = "1.2rem";
        </script>
        .

        <p>
            This is my version of some similar apps I found on the internet:
        </p>
        <ul>
            <li>
                <b> SereneBreath: </b>
                This was my first inspiration.
                A beautiful app.
                <p>
                    <a href="https://github.com/gsantiago/SereneBreath">GitHub</a>,
                    <a href="https://serenebreath.com/">Web app (seems to be down?)</a>
                </p>
            </li>
            <li>
                <b> Soothing Breathe: </b>
                A nice and simple idea.
                My version is visually very similar to this app.
                I have made it a web app (and free open source)
                and tried to make it a little bit easier to use.
                <p>
                    <a href="https://www.instagram.com/soothing_breathe/">Instagram @soothing_breathe</a>,
                    <a href="https://pocketbreathcoach.com/">Native app (not a web app)</a>,
                    <a href="https://www.youtube.com/@Headfulness">YouTube, Headfulness</a>
                </p>
            </li>
        </ul>



        <h3>What do we know about these kind of exercises?</h3>

        <p>
            Unfortunately I have not been able to find direct scientific supported
            for this type of exercises.
            There are however indirect support.
        <div style="color:red; background:black; padding:2px;"> (I will add some links here later.) </span>
            </p>

    </section>


    <section>
        <h2>Source code</h2>
        <p>
            If you are interested in the souce code for this web app you can find it on
            <a href="https://github.com/lborgman/meditation-helpers">GitHub</a>.
            It is all in JavaScript, HTML and CSS.
        </p>
    </section>

    <section>
    </section>
    <h2>Do you want to share this web app?</h2>

    <div style="color:red;">(Debug Note: make-abs.js)</div>
    <p>
        You just need a link to this web page.
        You can get it here:
    </p>
    <script>
        const currScript = document.currentScript;
        (async () => {
            await mcwPromise;
            console.log("after mcwPromise", mcwPromise);

            // const modMdc = await importModule("./src/js/mod/util-mdc.js");
            const modMdc = await import("util-mdc");
            if (!modMdc) throw Error("could not import modMdc");

            // const modQR = await importModule("./ext/qr/qrjs2.js");
            const modQR = await import("qrjs2");
            if (!modQR) throw Error("could not import modQR");

            const QRcode = modQR.default;

            const url = new URL(location);
            url.hash = "";
            const urlHref = url.href;
            const svg = QRcode.generateSVG(urlHref);

            const XMLS = new XMLSerializer();
            let s = XMLS.serializeToString(svg);
            s = "data:image/svg+xml;base64," + window.btoa(unescape(encodeURIComponent(s)));
            const dataUriSvgImage = mkElt("img");
            dataUriSvgImage.src = s;

            async function popupShare() {
                // const modMdc = await importModule("./src/js/mod/util-mdc.js");
                const modMdc = await import("util-mdc");
                /*
                const btnCopy = modMdc.mkMDCbutton("Copy", "raised");
                btnCopy.addEventListener("click", evt => {
                    copyToClipboardAndNotify(spanLoc, spanLoc.innerText);
                });
                */
                const spanLoc = mkElt("span", undefined,
                    mkElt("a", { "href": urlHref, "target": "_blank", "rel": "noreferrer" }, urlHref));
                spanLoc.style = `
                    display: inline-block;
                    overflow-wrap: anywhere;
                `;
                const locDiv = mkElt("div", null, [
                    spanLoc,
                    // btnCopy
                ]);
                // const title = "QR Code for web address";
                const body = mkElt("div", null,
                    [
                        mkElt("h2", undefined, "Share this page"),
                        mkElt("p", null, locDiv),
                        dataUriSvgImage
                    ]
                );

                modMdc.mkMDCdialogAlert(body, "Close");
            }
            const btnShare = modMdc.mkMDCbutton("Share", "raised");
            btnShare.addEventListener("click", evt => {
                popupShare();
            });
            if (!currScript) throw Error("currScript was undefined");
            currScript.insertAdjacentElement("afterend", btnShare);
        })();
    </script>

    </section>
</body>